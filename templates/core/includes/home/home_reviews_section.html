{% load static %}
{% load i18n %}

<section class="bg-primary py-16">
  <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 px-4">
    
    <!-- Левая часть - форма -->
    <div class="bg-white rounded-2xl shadow-lg p-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-6 leading-snug">
        {% trans "Подберём недвижимость " %}<br>{% trans "точно под ваши цели" %}
      </h2>
      <form id="reviewsSectionContactForm" class="space-y-6 js-recaptcha-form" data-recaptcha-action="reviews_contact">
        {% csrf_token %}
        {% include 'core/includes/recaptcha_token_field.html' %}
        {% include 'core/includes/form_security_fields.html' with honeypot_id='reviews-contact-website' %}
        
        <input type="text" 
               name="name"
               id="contact_name"
               placeholder="{% trans 'Имя*' %}"
               required
               class="w-full border-b-2 border-gray-300 focus:outline-none focus:border-accent py-3 text-gray-900 placeholder-gray-500 transition-colors" />
        
        <input type="email" 
               name="email"
               placeholder="{% trans 'Email*' %}"
               required
               class="w-full border-b-2 border-gray-300 focus:outline-none focus:border-accent py-3 text-gray-900 placeholder-gray-500 transition-colors" />
        
        <input type="tel" 
               name="phone"
               placeholder="{% trans 'Номер телефона' %}"
               class="w-full border-b-2 border-gray-300 focus:outline-none focus:border-accent py-3 text-gray-900 placeholder-gray-500 transition-colors" />
        
        <textarea placeholder="{% trans 'Расскажите, что вы ищете' %}" 
                  name="message"
                  rows="3"
                  required
                  class="w-full border-b-2 border-gray-300 focus:outline-none focus:border-accent py-3 text-gray-900 placeholder-gray-500 transition-colors resize-none"></textarea>

        <div class="flex items-start space-x-3">
          <input type="checkbox" 
                 id="privacy_consent" 
                 name="privacy_consent"
                 required
                 class="w-4 h-4 text-accent border-gray-300 rounded focus:ring-accent mt-1" />
          <label for="privacy_consent" class="text-sm text-gray-600">
            {% trans "Я согласен(на) с" %} <a href="#" class="text-accent underline">{% trans "политикой конфиденциальности" %}</a>
          </label>
        </div>

        <button type="submit" 
                class="w-full bg-accent hover:bg-yellow-500 text-gray-900 font-bold px-8 py-3 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
          {% trans "Отправить заявку" %}
        </button>
      </form>
    </div>

    <!-- Правая часть - отзывы -->
    <div class="flex flex-col">
      <!-- Заголовок с кнопками навигации -->
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-white text-2xl font-bold">{% trans "Клиенты говорят о нас" %}</h2>
        <div class="flex space-x-3">
          <button id="prev-btn" class="w-12 h-12 bg-white hover:bg-accent rounded-full shadow-lg text-gray-900 hover:text-gray-900 flex items-center justify-center cursor-pointer transition-all duration-300 hover:scale-110">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button id="next-btn" class="w-12 h-12 bg-white hover:bg-accent rounded-full shadow-lg text-gray-900 hover:text-gray-900 flex items-center justify-center cursor-pointer transition-all duration-300 hover:scale-110">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
      
      <!-- Карусель отзывов -->
      <div class="relative h-96">
        <div class="flex gap-6 h-full">
          <!-- Большой отзыв (активный) - 329x392 в Figma -->
          <!-- На мобильных: полная ширина, на десктопе: фиксированная ширина -->
          <div id="main-review" class="w-full md:w-80 h-96 bg-white rounded shadow-lg transition-all duration-500 transform p-6 md:p-10 flex flex-col">
            <div class="flex items-center space-x-4 mb-6">
              <div id="main-avatar" class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center text-white font-bold text-base">
                А
              </div>
              <div>
                <p id="main-name" class="font-bold text-gray-900 text-base">Александр К.</p>
                <p id="main-type" class="text-sm text-gray-500">{% trans "Квартира в Патонге" %}</p>
              </div>
            </div>
            <p id="main-text" class="text-gray-700 text-sm mb-6 flex-1 line-clamp-8">
              {% trans "Отличная работа команды! Помогли подобрать квартиру в Патонге, провели через все этапы сделки. Особенно благодарен Богдану за профессионализм и внимание к деталям." %}
            </p>
            <div class="flex items-center mt-auto">
              <div id="main-stars" class="flex text-yellow-400 text-sm mr-2">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
              </div>
              <span id="main-rating" class="text-gray-500 text-sm">5.0</span>
            </div>
          </div>

          <!-- Маленький отзыв (следующий) - 270x285 в Figma -->
          <!-- Скрыт на мобильных, показан только на десктопе -->
          <div id="next-review" class="hidden md:flex w-64 h-72 bg-gray-100 rounded-lg shadow-md transition-all duration-500 transform cursor-pointer hover:bg-gray-200 p-6 flex-col mt-14">
            <div class="flex items-center space-x-3 mb-4">
              <div id="next-avatar" class="w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                M
              </div>
              <div class="flex-1 min-w-0">
                <p id="next-name" class="font-bold text-gray-900 text-sm truncate">Marina S.</p>
                <p id="next-type" class="text-xs text-gray-500 truncate">{% trans "Вилла в Черн Талае" %}</p>
              </div>
            </div>
            <p id="next-text" class="text-gray-600 text-sm leading-relaxed flex-1 line-clamp-6">
              {% trans "Купили виллу в Черн Талае через Undersun Estate. Кирилл провёл отличную презентацию..." %}
            </p>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Google Maps Link -->
  <div class="text-center mt-12">
    <a href="https://maps.app.goo.gl/uSixwX12PuAL4KFr6" target="_blank"
       class="inline-flex items-center px-8 py-3 bg-white hover:bg-gray-50 text-gray-900 font-bold rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-200 transform hover:scale-105">
      <i class="fab fa-google text-2xl mr-4 text-yellow-500"></i>
      <span>{% trans "Посмотреть все отзывы в Google Maps" %}</span>
      <i class="fas fa-external-link-alt ml-3 text-lg"></i>
    </a>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const reviews = [
    {
      name: 'Александр К.',
      type: '{% trans "Квартира в Патонге" %}',
      text: '{% trans "Отличная работа команды! Помогли подобрать квартиру в Патонге, провели через все этапы сделки. Особенно благодарен Богдану за профессионализм и внимание к деталям." %}',
      shortText: '{% trans "Отличная работа команды! Помогли подобрать квартиру в Патонге..." %}',
      rating: 5.0,
      avatar: 'А',
      avatarColor: 'from-blue-400 to-blue-600'
    },
    {
      name: 'Marina S.',
      type: '{% trans "Вилла в Черн Талае" %}',
      text: '{% trans "Купили виллу в Черн Талае через Undersun Estate. Кирилл провёл отличную презентацию проектов, всё объяснил понятно. Процесс прошёл гладко, без неприятных сюрпризов." %}',
      shortText: '{% trans "Купили виллу в Черн Талае через Undersun Estate. Кирилл провёл отличную презентацию..." %}',
      rating: 5.0,
      avatar: 'M',
      avatarColor: 'from-purple-400 to-pink-600'
    },
    {
      name: 'Dmitry R.',
      type: '{% trans "Инвестиционное кондо" %}',
      text: '{% trans "Хороший сервис, адекватные цены. Виталий помог с выбором кондо для инвестиций. Единственное - процесс занял чуть больше времени чем ожидалось, но результат хороший." %}',
      shortText: '{% trans "Хороший сервис, адекватные цены. Виталий помог с выбором кондо..." %}',
      rating: 4.0,
      avatar: 'D',
      avatarColor: 'from-green-400 to-teal-600'
    },
    {
      name: 'Elena P.',
      type: '{% trans "Новый проект" %}',
      text: '{% trans "Очень довольны покупкой! Команда профессиональная, всегда были на связи. Помогли с оформлением всех документов. Рекомендую для покупки недвижимости в Таиланде." %}',
      shortText: '{% trans "Очень довольны покупкой! Команда профессиональная, всегда были на связи..." %}',
      rating: 5.0,
      avatar: 'Е',
      avatarColor: 'from-orange-400 to-red-600'
    },
    {
      name: 'Michael B.',
      type: 'International Client',
      text: 'Great experience working with Undersun Estate team. Professional approach, good selection of properties. Bogdan was very helpful throughout the process. Highly recommended!',
      shortText: 'Great experience working with Undersun Estate team. Professional approach...',
      rating: 5.0,
      avatar: 'M',
      avatarColor: 'from-indigo-400 to-blue-600'
    },
    {
      name: 'Ольга М.',
      type: '{% trans "Квартира в Камале" %}',
      text: '{% trans "Купили квартиру в новом проекте в Камале. Все прошло отлично! Особенно приятно было работать с русскоговорящими специалистами. Спасибо команде за поддержку!" %}',
      shortText: '{% trans "Купили квартиру в новом проекте в Камале. Все прошло отлично!..." %}',
      rating: 5.0,
      avatar: 'О',
      avatarColor: 'from-pink-400 to-purple-600'
    }
  ];

  let currentIndex = 0;

  function generateStars(rating) {
    let stars = '';
    const fullStars = Math.floor(rating);
    const hasHalfStar = rating % 1 !== 0;
    
    for (let i = 0; i < fullStars; i++) {
      stars += '<i class="fas fa-star"></i>';
    }
    
    if (hasHalfStar) {
      stars += '<i class="fas fa-star-half-alt"></i>';
    }
    
    const emptyStars = 5 - Math.ceil(rating);
    for (let i = 0; i < emptyStars; i++) {
      stars += '<i class="far fa-star"></i>';
    }
    
    return stars;
  }

  function updateReviews() {
    const currentReview = reviews[currentIndex];
    const nextReview = reviews[(currentIndex + 1) % reviews.length];

    // Обновляем главный отзыв
    document.getElementById('main-name').textContent = currentReview.name;
    document.getElementById('main-type').textContent = currentReview.type;
    document.getElementById('main-text').textContent = currentReview.text;
    document.getElementById('main-rating').textContent = currentReview.rating.toFixed(1);
    document.getElementById('main-stars').innerHTML = generateStars(currentReview.rating);
    document.getElementById('main-avatar').textContent = currentReview.avatar;
    document.getElementById('main-avatar').className = `w-12 h-12 bg-gradient-to-br ${currentReview.avatarColor} rounded-full flex items-center justify-center text-white font-bold text-base`;

    // Обновляем следующий отзыв (только если он виден на десктопе)
    const nextNameElement = document.getElementById('next-name');
    if (nextNameElement) {
      document.getElementById('next-name').textContent = nextReview.name;
      document.getElementById('next-type').textContent = nextReview.type;
      document.getElementById('next-text').textContent = nextReview.shortText;
      document.getElementById('next-avatar').textContent = nextReview.avatar;
      document.getElementById('next-avatar').className = `w-10 h-10 bg-gradient-to-br ${nextReview.avatarColor} rounded-full flex items-center justify-center text-white font-bold text-sm`;
    }
  }

  function nextReview() {
    currentIndex = (currentIndex + 1) % reviews.length;
    updateReviews();
  }

  function prevReview() {
    currentIndex = (currentIndex - 1 + reviews.length) % reviews.length;
    updateReviews();
  }

  // Кнопки навигации
  document.getElementById('next-btn').addEventListener('click', nextReview);
  document.getElementById('prev-btn').addEventListener('click', prevReview);

  // Клик по маленькому отзыву для переключения (только на десктопе)
  const nextReviewElement = document.getElementById('next-review');
  if (nextReviewElement) {
    nextReviewElement.addEventListener('click', nextReview);
  }

  // Автопрокрутка
  setInterval(nextReview, 5000);

  // Инициализация
  updateReviews();
});
</script>

<style>
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.line-clamp-3 {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.line-clamp-4 {
  display: -webkit-box;
  -webkit-line-clamp: 4;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.line-clamp-6 {
  display: -webkit-box;
  -webkit-line-clamp: 6;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.line-clamp-8 {
  display: -webkit-box;
  -webkit-line-clamp: 8;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
</style>
