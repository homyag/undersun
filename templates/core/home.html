{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load currency_tags %}
{#{% block title %}{% trans "Undersun Estate - Недвижимость на Пхукете, Таиланд" %}{% endblock %}#}
{% block title %}{{ page_title }}{% endblock %}
{% block structured_data %}
    {% include 'includes/home/home_structured_data.html' %}
{% endblock %}

{% block extra_css %}
    {% include 'includes/home/home_styles.html' %}
{% endblock %}
{% block extra_meta %}
    {{ block.super }}
    <meta name="google-site-verification" content="aP6xLXZRyd8rjDr9Pd3KDq61VSENUdQlEiup7f0TPIE">
    <link rel="preload"
          as="image"
          href="{% static 'images/home_page/homepage_hero_section/thailand_hero_section_1.webp' %}"
          fetchpriority="high"
          imagesrcset="{% static 'images/home_page/homepage_hero_section/thailand_hero_section_1.webp' %} 1280w"
          imagesizes="100vw">
{% endblock %}

{% block content %}
    <!-- Hero Section -->
    {% include 'core/includes/home/home_hero_section.html' %}
    <!-- Promotional Banner Section -->
    {% include 'core/includes/home/home_promotional_banner_section.html' %}
    <!-- Featured Properties -->
    {% include 'core/includes/home/home_featured_properties_section.html' %}
    <!-- Phone Contact Form Section -->
    {% include 'core/includes/home/home_phone_contact_form_section.html' %}
    <!-- New Arrivals Section -->
{#    {% include 'core/includes/home/home_new_arrivals_section.html' %}#}
    <!-- Districts -->
{#    {% include 'core/includes/home/home_districts_section.html' %}#}
    <!-- What we do for you -->
    {% include 'core/includes/home/home_what_we_do_for_you_section.html' %}
    <!-- Property Purchase Process Steps -->
    {% include 'core/includes/home/home_property_purchase_process_steps_section.html' %}
    <!-- Our Team -->
    {% include 'core/includes/home/home_our_team_section.html' %}
    <!-- Reviews Section -->
    {% include 'core/includes/home/home_reviews_section.html' %}
    <!-- FAQ Section -->
    {% include 'core/includes/home/home_faq_section.html' %}
    <!-- Visit Office Section -->
    {% include 'core/includes/home/home_visit_office_section.html' %}
    <!-- News Section -->
    {% include 'core/includes/home/home_news_section.html' %}
{% endblock %}

{% block extra_js %}
    <!-- Inject Django data for JavaScript -->
    {% include 'includes/home/home_data_injection.html' %}
    {% static 'js/home/hero.js' as hero_js %}
    {% static 'js/home/process-steps.js' as process_steps_js %}
    {% static 'js/home/featured-properties.js' as featured_js %}
    {% static 'js/home/consultation.js' as consultation_js %}
    {% static 'js/home/search-counter.js' as search_counter_js %}
    {% static 'js/home/our-team.js' as our_team_js %}
    <script>
        (function() {
            const scripts = [
                {src: '{{ hero_js }}', priority: 'high'},
                {src: '{{ process_steps_js }}'},
                {src: '{{ featured_js }}'},
                {src: '{{ consultation_js }}'},
                {src: '{{ search_counter_js }}'},
                {src: '{{ our_team_js }}'}
            ];

            function loadScript(entry) {
                if (!entry || document.querySelector(`script[src="${entry.src}"]`)) {
                    return;
                }
                const script = document.createElement('script');
                script.src = entry.src;
                script.defer = true;
                document.body.appendChild(script);
            }

            const criticalScripts = scripts.filter(item => item.priority === 'high');
            criticalScripts.forEach(loadScript);

            const restScripts = scripts.filter(item => item.priority !== 'high');
            if ('requestIdleCallback' in window) {
                requestIdleCallback(() => restScripts.forEach(loadScript), { timeout: 2000 });
            } else {
                setTimeout(() => restScripts.forEach(loadScript), 500);
            }
        })();
    </script>
{% endblock %}
