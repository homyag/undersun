{% load i18n %}
{% load currency_tags %}

<!-- Filters Sidebar -->
<div class="lg:col-span-1">
    <div id="filters-sidebar" class="bg-white rounded-lg shadow-md border border-gray-200 hidden lg:block">
        <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">
                {% trans "Фильтры" %}
            </h3>
        </div>
        
        <form method="get" action="" id="filter-form" class="p-6">
            <!-- Hidden sort field -->
            <input type="hidden" name="sort" value="{{ request.GET.sort|default:'-created_at' }}">
            
            <!-- Deal Type -->
            <div class="mb-6">
                <h4 class="font-semibold text-gray-900 mb-3">
                    {% trans "Тип сделки" %}
                </h4>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="radio" name="deal_type" value="" {% if not request.GET.deal_type %}checked{% endif %} class="w-4 h-4 text-accent border-gray-300 focus:ring-accent">
                        <span class="ml-3 text-sm text-gray-700">{% trans "Все объекты" %}</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="deal_type" value="sale" {% if request.GET.deal_type == 'sale' %}checked{% endif %} class="w-4 h-4 text-accent border-gray-300 focus:ring-accent">
                        <span class="ml-3 text-sm text-gray-700">{% trans "Продажа" %}</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="deal_type" value="rent" {% if request.GET.deal_type == 'rent' %}checked{% endif %} class="w-4 h-4 text-accent border-gray-300 focus:ring-accent">
                        <span class="ml-3 text-sm text-gray-700">{% trans "Аренда" %}</span>
                    </label>
                </div>
            </div>
            
            <!-- Property Type -->
            <div class="mb-6">
                <h4 class="font-semibold text-gray-900 mb-3">
                    {% trans "Тип недвижимости" %}
                </h4>
                <div class="space-y-2">
                    {% for property_type in property_types %}
                    <label class="flex items-center">
                        <input type="checkbox" name="property_type" value="{{ property_type.name }}" 
                               {% if property_type.name in request.GET.property_type %}checked{% endif %} 
                               class="w-4 h-4 text-primary border-gray-300 focus:ring-primary rounded">
                        <span class="ml-3 text-sm text-gray-700">{{ property_type.name_display }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Price Range -->
            <div class="mb-6">
                <h4 class="font-semibold text-gray-900 mb-3">
                    {% trans "Бюджет" %}, {{ selected_currency.code|default:'USD' }}
                </h4>
                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-2">
                        <div class="relative">
                            <input type="number" name="min_price" value="{{ request.GET.min_price }}" 
                                   placeholder="От" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-primary">
                            <div class="price-loading-indicator hidden absolute right-2 top-1/2 transform -translate-y-1/2">
                                <div class="w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"></div>
                            </div>
                        </div>
                        <div class="relative">
                            <input type="number" name="max_price" value="{{ request.GET.max_price }}" 
                                   placeholder="До" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-primary">
                            <div class="price-loading-indicator hidden absolute right-2 top-1/2 transform -translate-y-1/2">
                                <div class="w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"></div>
                            </div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500">
                        {% trans "Укажите бюджет в" %} {{ selected_currency.code|default:'USD' }}
                    </div>
                </div>
            </div>
            
            <!-- Districts -->
            <div class="mb-6">
                <h4 class="font-semibold text-gray-900 mb-3">
                    {% trans "Район" %}
                </h4>
                <select name="district" id="district-select" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-primary">
                    <option value="">{% trans "Все районы" %}</option>
                    {% for district in districts %}
                    <option value="{{ district.slug }}" {% if request.GET.district == district.slug %}selected{% endif %}>
                        {{ district.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Locations -->
            <div class="mb-6" id="location-filter">
                <h4 class="font-semibold text-gray-900 mb-3">
                    {% trans "Локация" %}
                </h4>
                <select name="location" id="location-select" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary focus:border-primary">
                    <option value="">{% trans "Все локации" %}</option>
                    {% for location in locations %}
                    <option value="{{ location.slug }}" {% if request.GET.location == location.slug %}selected{% endif %}>
                        {{ location.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Bedrooms -->
            <div class="mb-6">
                <h4 class="font-semibold text-gray-900 mb-3">
                    {% trans "Количество спален" %}
                </h4>
                <div class="space-y-2">
                    {% for i in "1234" %}
                    <label class="flex items-center">
                        <input type="checkbox" name="bedrooms" value="{{ i }}" 
                               {% if i in request.GET.bedrooms %}checked{% endif %} 
                               class="w-4 h-4 text-primary border-gray-300 focus:ring-primary rounded">
                        <span class="ml-3 text-sm text-gray-700">{{ i }}{% if i == "4" %}+{% endif %} {% trans "спальня" %}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Amenities -->
            <div class="mb-6">
                <h4 class="font-semibold text-gray-900 mb-3">
                    {% trans "Удобства" %}
                </h4>
                <div class="space-y-2">
                    {% for amenity in amenities %}
                    <label class="flex items-center">
                        <input type="checkbox" name="amenities" value="{{ amenity.id }}" 
                               {% if amenity.id|stringformat:"s" in current_filters.amenities %}checked{% endif %} 
                               class="w-4 h-4 text-primary border-gray-300 focus:ring-primary rounded">
                        <span class="ml-3 text-sm text-gray-700 flex items-center">
                            {% if amenity.icon %}
                                <i class="{{ amenity.icon }} mr-2 text-accent"></i>
                            {% endif %}
                            {{ amenity.name }}
                        </span>
                    </label>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Filter Actions -->
            <div class="border-t border-gray-200 pt-4 mt-4">
                <div class="space-y-2">
                    <button type="submit" class="w-full bg-primary hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                        {% trans "Применить" %}
                    </button>
                    <a href="{% url 'properties:property_list' %}" class="w-full text-center bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-md transition-colors block">
                        {% trans "Очистить" %}
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>