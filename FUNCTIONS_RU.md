# Undersun Estate - Документация функций

Данный документ содержит исчерпывающий справочник всех функций проекта Undersun Estate Django, включая функции Python и JavaScript, используемые в платформе недвижимости.

## Содержание

- [Функции Python](#функции-python)
  - [Приложение Core](#приложение-core)
  - [Приложение Properties](#приложение-properties)
  - [Приложение Currency](#приложение-currency)
  - [Приложение Locations](#приложение-locations)
  - [Приложение Blog](#приложение-blog)
  - [Приложение Users](#приложение-users)
  - [Management команды](#management-команды)
- [Функции JavaScript](#функции-javascript)
  - [Основные функции JavaScript](#основные-функции-javascript)
  - [Функции JavaScript админки](#функции-javascript-админки)
  - [Функции JavaScript шаблонов](#функции-javascript-шаблонов)
- [Контекстные процессоры](#контекстные-процессоры)
- [Утилиты перевода](#утилиты-перевода)

---

## Функции Python

### Приложение Core

#### Модели (`apps/core/models.py`)

**Модель SEOPage**
- `get_title(language_code='ru')` - Получить заголовок страницы для указанного языка с возвратом к русскому
  - **Параметры**: `language_code` (str) - Код языка (ru, en, th)
  - **Возвращает**: str - Заголовок страницы
  - **Использование**: Генерация SEO мета-тегов

- `get_description(language_code='ru')` - Получить описание страницы для указанного языка
  - **Параметры**: `language_code` (str) - Код языка
  - **Возвращает**: str - Описание страницы
  - **Использование**: Генерация SEO мета-описания

- `get_keywords(language_code='ru')` - Получить ключевые слова страницы для указанного языка
  - **Параметры**: `language_code` (str) - Код языка
  - **Возвращает**: str - Ключевые слова через запятую
  - **Использование**: Генерация SEO мета-ключевых слов

**Модель PromotionalBanner**
- `get_active_banner(language_code=None)` - Метод класса, возвращающий баннер для главной страницы
  - **Параметры**: `language_code` (str, опционально) – двухсимвольный код языка
  - **Возвращает**: PromotionalBanner или None
  - **Использование**: Отображение баннера для текущего языка (fallback на RU при отсутствии локали)

- `get_language_aware_url(language_code=None)` - Построить ссылку с учётом языка
  - **Параметры**: `language_code` (str, опционально) - Целевой язык
  - **Возвращает**: str или None - URL со вставленным языковым префиксом (при необходимости)
  - **Использование**: Переходы по баннеру c мультиязычной поддержкой
  - **Зависимости**: reverse(), текущий язык пользователя

- `image_disclaimer()` - Текст с требованиями к изображениям баннера
  - **Параметры**: None
  - **Возвращает**: str - i18n-строка с рекомендациями
  - **Использование**: Подсказка контент-менеджерам в админке и на сайте

**Модель SEOTemplate**
- `get_template(field_type, language_code='ru')` - Получить шаблон для поля и языка
  - **Параметры**: `field_type` (str), `language_code` (str)
  - **Возвращает**: str - Текст шаблона
  - **Использование**: Генерация SEO контента

- `render_template(template_text, property_obj, language_code='ru')` - Отрендерить шаблон с данными объекта
  - **Параметры**: `template_text` (str), `property_obj` (Property), `language_code` (str)
  - **Возвращает**: str - Отрендеренный контент
  - **Использование**: Динамическая генерация SEO
  - **Зависимости**: Атрибуты модели Property, обработка регулярных выражений

- `generate_seo_for_property(property_obj, language_code='ru')` - Сгенерировать полные SEO данные
  - **Параметры**: `property_obj` (Property), `language_code` (str)
  - **Возвращает**: dict - SEO данные (title, description, keywords)
  - **Использование**: Автоматическое создание SEO для объектов недвижимости

**Модель Service**
- `get_absolute_url()` - Получить URL страницы услуги
  - **Параметры**: None
  - **Возвращает**: str - URL деталей услуги
  - **Использование**: Навигация по страницам услуг

- `get_meta_title()` - Получить SEO заголовок или резервный основной заголовок
  - **Параметры**: None
  - **Возвращает**: str - Заголовок страницы для SEO
  - **Использование**: Генерация мета-тегов

- `get_meta_description()` - Получить SEO описание или резервное
  - **Параметры**: None
  - **Возвращает**: str - Мета-описание
  - **Использование**: Генерация мета-тегов

- `get_menu_services()` - Метод класса для получения услуг для отображения в меню
  - **Параметры**: None
  - **Возвращает**: QuerySet - Активные услуги для меню
  - **Использование**: Заполнение навигационного меню

#### Представления (`apps/core/views.py`)

**Утилитарные функции**
- `serialize_properties_for_js(properties)` - Преобразовать QuerySet объектов в JSON для JavaScript
  - **Параметры**: `properties` (QuerySet) - Объекты Property
  - **Возвращает**: str - JSON строка
  - **Использование**: Передача данных объектов во фронтенд
  - **Побочные эффекты**: Форматирование цен, конвертация валют

**Класс HomeView**
- `get_context_data(**kwargs)` - Подготовить контекстные данные главной страницы
  - **Параметры**: `**kwargs` - Аргументы представления
  - **Возвращает**: dict - Контекст шаблона
  - **Использование**: Рендеринг главной страницы
  - **Зависимости**: Фильтрация объектов, сериализация, расчет статистики

**Класс SearchView**
- `get_context_data(**kwargs)` - Подготовить контекст результатов поиска
  - **Параметры**: `**kwargs` - Аргументы представления
  - **Возвращает**: dict - Результаты поиска и фильтры
  - **Использование**: Функциональность поиска
  - **Зависимости**: Фильтрация объектов, пагинация, валютные сервисы

- `apply_filters(queryset)` - Применить фильтры поиска к QuerySet объектов (метод PropertyListView)
  - **Параметры**: `queryset` (QuerySet) - Базовый QuerySet объектов
  - **Возвращает**: QuerySet - Отфильтрованные объекты
  - **Использование**: Поиск и фильтрация объектов недвижимости
  - **Побочные эффекты**: Построение сложных запросов с множественными типами фильтров

#### Сервисы (`apps/core/services.py`)

**Класс TranslationService**
- `translate_text(text, target_language, preserve_html=False)` - Перевести текст используя настроенный API
  - **Параметры**: `text` (str), `target_language` (str), `preserve_html` (bool)
  - **Возвращает**: str или None - Переведенный текст
  - **Использование**: Автоматизированный перевод контента
  - **Зависимости**: Google Translate API или DeepL API, обработка HTML

- `translate_model_fields(instance, fields)` - Перевести множественные поля модели
  - **Параметры**: `instance` (Model), `fields` (list) - Имена полей для перевода
  - **Возвращает**: dict - Результаты перевода по полям и языкам
  - **Использование**: Массовый перевод моделей
  - **Побочные эффекты**: API вызовы, ограничение частоты запросов

- `apply_translations_to_model(instance, translations)` - Применить переводы к экземпляру модели
  - **Параметры**: `instance` (Model), `translations` (dict)
  - **Возвращает**: None
  - **Использование**: Сохранение переведенного контента в модель
  - **Побочные эффекты**: Обновления полей модели

- `is_configured()` - Проверить, правильно ли настроен сервис перевода
  - **Параметры**: None
  - **Возвращает**: bool - Статус конфигурации
  - **Использование**: Проверка доступности функции

#### Контекстные процессоры (`apps/core/context_processors.py`)

- `site_context(request)` - Глобальный контекст сайта для всех шаблонов
  - **Параметры**: `request` (HttpRequest)
  - **Возвращает**: dict - Глобальные переменные шаблона
  - **Использование**: Рендеринг шаблонов на всех страницах
  - **Зависимости**: Типы объектов, районы, услуги, определение языка

- `seo_context(request)` - SEO контекст на основе текущего URL
  - **Параметры**: `request` (HttpRequest)
  - **Возвращает**: dict - Данные SEO мета-тегов
  - **Использование**: Динамическая генерация SEO
  - **Зависимости**: Сопоставление шаблонов URL, SEO шаблоны, модель Property

### Приложение Properties

#### Модели (`apps/properties/models.py`)

**Модель Property**
- `get_absolute_url()` - Получить URL страницы деталей объекта
  - **Параметры**: None
  - **Возвращает**: str - URL деталей объекта
  - **Использование**: Навигация по страницам объектов

- `main_image` (свойство) - Получить главное изображение объекта
  - **Параметры**: None
  - **Возвращает**: PropertyImage или None
  - **Использование**: Отображение объекта в списках и деталях

- `price_display` (свойство) - Получить отформатированную цену для отображения
  - **Параметры**: None
  - **Возвращает**: str - Отформатированная цена с валютой
  - **Использование**: Отображение цены объекта
  - **Побочные эффекты**: Форматирование валюты, расчет скидки

- `get_price_per_sqm_in_currency(currency_code, deal_type='sale')` - Рассчитать цену за квадратный метр
  - **Параметры**: `currency_code` (str), `deal_type` (str)
  - **Возвращает**: float или None - Цена за кв.м
  - **Использование**: Сравнение стоимости объектов
  - **Зависимости**: Конвертация валют, валидация площади

- `get_formatted_price_per_sqm(currency_code='THB', deal_type='sale')` - Получить отформатированную цену за кв.м
  - **Параметры**: `currency_code` (str), `deal_type` (str) 
  - **Возвращает**: str или None - Отформатированная цена за кв.м с валютой
  - **Использование**: Отображение в списках объектов

- `get_price_in_currency(currency_code, deal_type='sale')` - Конвертировать цену в указанную валюту
  - **Параметры**: `currency_code` (str), `deal_type` (str)
  - **Возвращает**: Decimal или None - Цена в целевой валюте
  - **Использование**: Мультивалютное отображение цен
  - **Зависимости**: Конвертация обменного курса, сохраненные поля цен

- `get_formatted_price(currency_code='THB', deal_type='sale')` - Получить полностью отформатированную цену
  - **Параметры**: `currency_code` (str), `deal_type` (str)
  - **Возвращает**: str - Отформатированная цена с символом валюты
  - **Использование**: Отображение цены во фронтенде

- `has_custom_seo(language_code='ru')` - Проверить, есть ли у объекта пользовательские SEO
  - **Параметры**: `language_code` (str)
  - **Возвращает**: bool - Доступность пользовательских SEO
  - **Использование**: Принятие решения по генерации SEO

- `get_custom_seo(language_code='ru')` - Получить пользовательские SEO данные
  - **Параметры**: `language_code` (str)
  - **Возвращает**: dict - Пользовательские SEO поля
  - **Использование**: Генерация SEO мета-тегов

- `get_seo_template()` - Найти подходящий SEO шаблон для объекта
  - **Параметры**: None
  - **Возвращает**: SEOTemplate или None
  - **Использование**: Автоматизированная генерация SEO
  - **Зависимости**: Сопоставление типа объекта и типа сделки

#### Представления (`apps/properties/views.py`)

**Класс PropertyListView**
- `get_queryset()` - Получить отфильтрованный QuerySet объектов
  - **Параметры**: None
  - **Возвращает**: QuerySet - Отфильтрованные объекты
  - **Использование**: Страницы списков объектов
  - **Зависимости**: Применение фильтров, сортировка, оптимизация базы данных

- `apply_filters(queryset)` - Применить параметры поиска и фильтрации
  - **Параметры**: `queryset` (QuerySet)
  - **Возвращает**: QuerySet - Отфильтрованные объекты
  - **Использование**: Функциональность поиска объектов
  - **Побочные эффекты**: Построение сложных запросов, фильтрация цен, текстовый поиск

- `get_context_data(**kwargs)` - Подготовить контекст списка объектов
  - **Параметры**: `**kwargs`
  - **Возвращает**: dict - Контекст шаблона с фильтрами и результатами
  - **Использование**: Рендеринг шаблона списка объектов

#### Сервисы (`apps/properties/services.py`)

- `translate_property(property_obj, target_languages=None, force_retranslate=False)` - Перевести контент объекта
  - **Параметры**: `property_obj` (Property), `target_languages` (list), `force_retranslate` (bool)
  - **Возвращает**: None
  - **Использование**: Управление многоязычным контентом
  - **Побочные эффекты**: API вызовы, обновления модели, перевод полей
  - **Зависимости**: Конфигурация сервиса перевода

- `translate_property_type(property_type_obj, target_languages=None, force_retranslate=False)` - Перевести тип объекта
  - **Параметры**: `property_type_obj` (PropertyType), `target_languages` (list), `force_retranslate` (bool)
  - **Возвращает**: None
  - **Использование**: Локализация типов объектов
  - **Побочные эффекты**: Обновления модели, использование API перевода

### Приложение Currency

#### Модели (`apps/currency/models.py`)

**Модель Currency**
- `save(*args, **kwargs)` - Переопределение для обеспечения единственной базовой валюты
  - **Параметры**: Стандартные параметры save
  - **Возвращает**: None
  - **Использование**: Управление валютами
  - **Побочные эффекты**: Обеспечивает существование только одной базовой валюты

**Модель ExchangeRate**
- `get_latest_rate(base_currency, target_currency)` - Метод класса для получения последнего курса обмена
  - **Параметры**: `base_currency` (Currency), `target_currency` (Currency)
  - **Возвращает**: Decimal или None - Последний курс обмена
  - **Использование**: Расчеты конвертации валют
  - **Зависимости**: Запросы к базе данных, расчет обратного курса

- `convert_amount(amount, from_currency, to_currency)` - Метод класса для конвертации сумм
  - **Параметры**: `amount` (Decimal), `from_currency` (Currency), `to_currency` (Currency)
  - **Возвращает**: Decimal или None - Конвертированная сумма
  - **Использование**: Конвертация цен между валютами
  - **Зависимости**: Поиск обменного курса, математическая конвертация

#### Сервисы (`apps/currency/services.py`)

**Класс CurrencyService**
- `get_currency_for_language(language_code)` - Статический метод получения валюты по умолчанию для языка
  - **Параметры**: `language_code` (str)
  - **Возвращает**: Currency или None
  - **Использование**: Отображение валюты специфичной для языка
  - **Зависимости**: Модель CurrencyPreference, резервная логика

- `get_active_currencies()` - Статический метод получения всех активных валют
  - **Параметры**: None
  - **Возвращает**: QuerySet - Активные валюты
  - **Использование**: Заполнение селектора валют

- `get_currency_by_code(code)` - Статический метод получения валюты по коду
  - **Параметры**: `code` (str) - Код валюты (USD, EUR, и т.д.)
  - **Возвращает**: Currency или None
  - **Использование**: Поиск и валидация валют

- `convert_price(amount, from_currency_code, to_currency_code)` - Конвертировать цену между валютами
  - **Параметры**: `amount` (Decimal), `from_currency_code` (str), `to_currency_code` (str)
  - **Возвращает**: Decimal или None - Конвертированная цена
  - **Использование**: Конвертация цен в реальном времени
  - **Зависимости**: Сервис обменных курсов, валидация валют

- `format_price(amount, currency_code)` - Отформатировать цену с символом валюты
  - **Параметры**: `amount` (Decimal), `currency_code` (str)
  - **Возвращает**: str - Отформатированная строка цены
  - **Использование**: Форматирование отображения цены

- `get_latest_rates_summary()` - Получить сводку всех текущих обменных курсов
  - **Параметры**: None
  - **Возвращает**: dict - Сводка курсов по коду валюты
  - **Использование**: Админ панель, обзор курсов

### Приложение Locations

#### Модели (`apps/locations/models.py`)

**Модель District**
- `get_absolute_url()` - Получить URL страницы деталей района
  - **Параметры**: None
  - **Возвращает**: str - URL деталей района
  - **Использование**: Навигация по страницам районов

**Модель Location**
- `get_absolute_url()` - Получить URL страницы деталей локации
  - **Параметры**: None
  - **Возвращает**: str - URL деталей локации
  - **Использование**: Навигация по страницам локаций
  - **Зависимости**: Слаг района для построения URL

### Приложение Blog

#### Модели (`apps/blog/models.py`)

**Модель BlogCategory**
- `get_absolute_url()` - Получить URL страницы категории
  - **Параметры**: None
  - **Возвращает**: str - URL страницы категории
  - **Использование**: Навигация по категориям блога

### Management команды

#### Валютные команды

**Команда setup_currencies** (`apps/currency/management/commands/setup_currencies.py`)
- `handle(*args, **options)` - Установить начальные валюты и языковые предпочтения
  - **Параметры**: Аргументы и опции командной строки
  - **Возвращает**: None
  - **Использование**: Первоначальная настройка проекта
  - **Побочные эффекты**: Создание/обновление записей Currency и CurrencyPreference

**Команда update_exchange_rates** (`apps/currency/management/commands/update_exchange_rates.py`)
- `handle(*args, **options)` - Обновить обменные курсы из внешнего API
  - **Параметры**: Аргументы команды включая базовую валюту и URL API
  - **Возвращает**: None
  - **Использование**: Запланированные обновления курсов обмена
  - **Побочные эффекты**: API вызовы, обновления базы данных, обновления цен объектов
  - **Зависимости**: Внешний API (exchangerate-api.com), интернет соединение

- `add_arguments(parser)` - Определить аргументы команды
  - **Параметры**: `parser` (ArgumentParser)
  - **Возвращает**: None
  - **Использование**: Парсинг аргументов командной строки

- `update_property_prices()` - Обновить цены объектов на основе новых обменных курсов
  - **Параметры**: None
  - **Возвращает**: None
  - **Использование**: Автоматическая синхронизация цен
  - **Побочные эффекты**: Массовые обновления модели объектов

---

## Функции JavaScript

### Основные функции JavaScript (`static/js/main.js`)

#### Основные функции

- `getCookie(name)` - Получить CSRF токен из куков
  - **Параметры**: `name` (string) - Имя куки
  - **Возвращает**: string - Значение куки
  - **Использование**: Получение CSRF токена для AJAX запросов
  - **Зависимости**: API куков браузера

#### Функции карусели

- `nextSlide()` - Перейти к следующему слайду героической карусели
  - **Параметры**: None
  - **Возвращает**: None
  - **Использование**: Автоматическая ротация героических изображений
  - **Побочные эффекты**: Манипуляция классами DOM, переходы слайдов

#### Управление избранным

- `getFavorites()` - Получить список избранного из localStorage
  - **Параметры**: None
  - **Возвращает**: Array - ID объектов в избранном
  - **Использование**: Локальное управление избранным

- `saveFavorites(favorites)` - Сохранить избранное в localStorage
  - **Параметры**: `favorites` (Array) - ID объектов
  - **Возвращает**: None
  - **Использование**: Сохранение избранного между сессиями
  - **Побочные эффекты**: Обновления localStorage

- `isFavorite(propertyId)` - Проверить, находится ли объект в избранном
  - **Параметры**: `propertyId` (number) - ID объекта
  - **Возвращает**: boolean - Статус избранного
  - **Использование**: Управление состоянием UI

- `toggleFavorite(propertyId, icon)` - Добавить/удалить объект из избранного
  - **Параметры**: `propertyId` (number), `icon` (jQuery object, опционально)
  - **Возвращает**: boolean - Новый статус избранного
  - **Использование**: Взаимодействие с кнопкой избранного
  - **Побочные эффекты**: Обновления localStorage, обновления UI, уведомления

- `updateFavoritesCounter()` - Обновить отображение счетчика избранного
  - **Параметры**: None
  - **Возвращает**: None
  - **Использование**: Обновления значка навигации
  - **Побочные эффекты**: Обновления текста DOM, изменения видимости

- `initializeFavorites()` - Инициализировать состояния кнопок избранного при загрузке страницы
  - **Параметры**: None
  - **Возвращает**: None
  - **Использование**: Инициализация страницы
  - **Побочные эффекты**: Обновления состояния иконок на основе localStorage

#### Фильтрация объектов и AJAX

- `updatePropertyFilters()` - Обновить списки объектов через AJAX
  - **Параметры**: None
  - **Возвращает**: None
  - **Использование**: Динамическая фильтрация объектов без перезагрузки страницы
  - **Побочные эффекты**: AJAX запросы, обновления DOM, обновления истории URL
  - **Зависимости**: Серверный API фильтрации

- `updatePropertiesGrid(properties)` - Обновить сетку объектов новыми данными
  - **Параметры**: `properties` (Array) - Объекты данных объектов
  - **Возвращает**: None
  - **Использование**: Динамические обновления контента
  - **Побочные эффекты**: Замена DOM, переинициализация обработчиков событий

- `createPropertyCard(property)` - Сгенерировать HTML для карточки объекта
  - **Параметры**: `property` (Object) - Данные объекта
  - **Возвращает**: string - HTML разметка для карточки объекта
  - **Использование**: Динамическое создание карточек объектов
  - **Зависимости**: Структура данных объекта, система избранного

- `updatePagination(pagination)` - Обновить элементы управления пагинацией
  - **Параметры**: `pagination` (Object) - Данные пагинации
  - **Возвращает**: None
  - **Использование**: Обновления AJAX пагинации
  - **Побочные эффекты**: Обновления DOM, подключение обработчиков событий

- `updateResultsCount(count)` - Обновить счетчик результатов поиска
  - **Параметры**: `count` (number) - Количество результатов
  - **Возвращает**: None
  - **Использование**: Отображение обратной связи поиска
  - **Побочные эффекты**: Обновления текста DOM

#### Функции галереи и изображений

- `openImageGallery(images, startIndex)` - Открыть модальную галерею изображений объекта
  - **Параметры**: `images` (Array), `startIndex` (number, по умолчанию 0)
  - **Возвращает**: None
  - **Использование**: Просмотр изображений объектов
  - **Побочные эффекты**: Создание модального окна, привязка клавиатурных событий, манипуляция DOM

#### Функции карты

- `initPropertyMap()` - Инициализировать карту объектов с Leaflet
  - **Параметры**: None
  - **Возвращает**: None
  - **Использование**: Отображение карты объектов
  - **Зависимости**: Библиотека Leaflet, координаты объектов
  - **Побочные эффекты**: Рендеринг карты, кластеризация маркеров

- `filterMapMarkers()` - Фильтровать маркеры карты по типу объекта
  - **Параметры**: None
  - **Возвращает**: None
  - **Использование**: Функциональность фильтрации карты
  - **Побочные эффекты**: Обновления видимости маркеров

#### Функции поиска

- `searchProperties(query)` - Выполнить поиск объектов с автодополнением
  - **Параметры**: `query` (string) - Поисковый запрос
  - **Возвращает**: None
  - **Использование**: Отображение предложений поиска
  - **Побочные эффекты**: AJAX запросы, обновления выпадающего списка
  - **Зависимости**: Конечная точка API поиска

#### Утилитарные функции

- `showNotification(message, type)` - Отобразить всплывающее уведомление
  - **Параметры**: `message` (string), `type` (string, по умолчанию 'info')
  - **Возвращает**: None
  - **Использование**: Отображение обратной связи пользователя
  - **Побочные эффекты**: Вставка DOM, автоматическое удаление после таймаута

- `formatPrice(price)` - Отформатировать цену для отображения
  - **Параметры**: `price` (number) - Значение цены
  - **Возвращает**: string - Отформатированная цена с символом валюты
  - **Использование**: Форматирование отображения цены

- `formatArea(area)` - Отформатировать площадь для отображения
  - **Параметры**: `area` (number) - Площадь в квадратных метрах
  - **Возвращает**: string - Отформатированная площадь с единицами
  - **Использование**: Отображение площади объекта

- `validateForm(form)` - Валидировать поля формы
  - **Параметры**: `form` (jQuery object) - Элемент формы
  - **Возвращает**: boolean - Результат валидации
  - **Использование**: Клиентская валидация формы
  - **Побочные эффекты**: Обновления CSS классов, изменения состояния валидации

### Функции JavaScript админки (`static/admin/js/seo_admin.js`)

#### Администрирование SEO

- `addCharacterCounter(element, maxLength, warningLength)` - Добавить счетчик символов к SEO полям
  - **Параметры**: `element` (DOM элемент), `maxLength` (number), `warningLength` (number)
  - **Возвращает**: None
  - **Использование**: Мониторинг длины SEO полей
  - **Побочные эффекты**: Вставка DOM, подключение слушателей событий, обновления счетчика в реальном времени

### Функции JavaScript шаблонов (`templates/base.html`)

#### Функции навигации

- `toggleMobileSubmenu(submenuId)` - Переключить видимость подменю мобильного меню
  - **Параметры**: `submenuId` (string) - ID подменю для переключения
  - **Возвращает**: None
  - **Использование**: Взаимодействие мобильной навигации
  - **Побочные эффекты**: Переключения CSS классов, поворот стрелки

- `toggleMobileSearch()` - Переключить видимость формы мобильного поиска
  - **Параметры**: None
  - **Возвращает**: None
  - **Использование**: Интерфейс мобильного поиска
  - **Побочные эффекты**: Переключения CSS классов

#### Переключение валюты

- Обработчики событий селектора мобильной валюты - Обработка переключения валюты в мобильном меню
  - **Параметры**: Объекты событий
  - **Возвращает**: None
  - **Использование**: Обновления предпочтений валюты
  - **Побочные эффекты**: AJAX запросы, перезагрузка страницы или обновления цен, обновления сессии
  - **Зависимости**: Конечная точка API изменения валюты

#### Поведение скролла

- Обработчик события скролла - Управление поведением навигационной панели при скролле
  - **Параметры**: Событие скролла
  - **Возвращает**: None
  - **Использование**: Динамическое позиционирование навигации
  - **Побочные эффекты**: Обновления CSS transform, адаптивное поведение

---

## Контекстные процессоры

### Контекст сайта (`apps/core/context_processors.py`)

- `site_context(request)` - Предоставляет глобальные переменные шаблона
  - **Доступно во всех шаблонах**: property_types, districts, current_language, menu_services
  - **Использование**: Навигационные меню, фильтры, глобальные данные сайта

- `seo_context(request)` - Предоставляет SEO мета-теги для страниц
  - **Доступно во всех шаблонах**: page_title, page_description, page_keywords
  - **Использование**: Динамическая генерация SEO мета-тегов на основе шаблонов URL

---

## Утилиты перевода

### Сервис перевода (`apps/core/services.py`)

Класс TranslationService предоставляет возможности автоматизированного перевода контента используя Google Translate или DeepL APIs.

**Ключевые методы:**
- Перевод контента с сохранением HTML
- Массовый перевод полей модели
- Ограничение частоты API и обработка ошибок
- Выбор резервного сервиса

**Примеры использования:**
- Перевод описаний объектов
- Локализация SEO контента  
- Перевод контента админского интерфейса

---

## Индекс функций

### По функциональности

**SEO и мета-теги:**
- `get_title()`, `get_description()`, `get_keywords()` - SEO контент страницы
- `get_meta_title()`, `get_meta_description()` - SEO страницы услуг
- `seo_context()` - Динамическая генерация SEO
- `render_template()`, `generate_seo_for_property()` - Автоматизированный SEO

**Валюта и ценообразование:**
- `get_price_in_currency()`, `convert_price()` - Конвертация валют
- `format_price()`, `get_formatted_price()` - Форматирование цен
- `get_latest_rate()`, `convert_amount()` - Обменные курсы
- `update_exchange_rates()` - Синхронизация курсов

**Управление объектами:**
- `apply_filters()`, `get_queryset()` - Фильтрация объектов
- `serialize_properties_for_js()` - Передача данных во фронтенд
- `get_price_per_sqm_in_currency()` - Метрики объектов
- `translate_property()` - Локализация контента

**Пользовательский интерфейс:**
- `toggleFavorite()`, `updateFavoritesCounter()` - Система избранного
- `showNotification()` - Обратная связь пользователя
- `updatePropertyFilters()` - Динамическая фильтрация
- `initPropertyMap()` - Функциональность карты

**Административные:**
- `setup_currencies()`, `update_exchange_rates()` - Настройка системы
- `addCharacterCounter()` - Улучшения админского UI
- `translate_text()` - Перевод контента

Данная документация служит исчерпывающим справочником для всех функций платформы Undersun Estate, предоставляя разработчикам подробную информацию о назначении, параметрах и контексте использования каждой функции.
